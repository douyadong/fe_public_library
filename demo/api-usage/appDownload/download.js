/***
    打开本地已有app，如没有,跳转到相应的配置页面
****/
(function($) {
    $.fn.downloadApp = function(options) {
            /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
            配置属性的扩展
            -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
            var opts = $.extend({}, $.fn.downloadApp.defaults, options);
            if (!opts.androidSchemes && !opts.isoSchemes) {
                console.error("请配置APP Schemes!");
                return;
            }
            $.fn.downloadApp.init(opts);
        }
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        初始化
        1.opts:配置信息
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    $.fn.downloadApp.init = function(opts) {
        if (navigator.userAgent.match(/(iPhone|iPod|iPad);?/i)) {
            var loadDateTime = new Date();
            window.setTimeout(function() {
                    var timeOutDateTime = new Date();
                    if (timeOutDateTime - loadDateTime < 1010) {
                        window.location = opts.isoSchemes;
                    } else {
                        window.close();
                    }
                },
                1000);
            window.location = opts.iosDownloadLink;
        } else if (navigator.userAgent.match(/android/i)) {
            var state = null;
            try {
                state = window.open(opts.androidSchemes, '_blank');
            } catch (e) {
                console.log(e);
            }
            if (state) {
                window.close();
            } else {
                window.location = opts.androidDownloadLink;
            }
        }
    }

    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    downloadApp 插件默认配置
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    $.fn.downloadApp.defaults = {
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        android custom url schemes
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        androidSchemes: "wkzf://group_chat/parameter?groupId=1000&userId=22332",
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        ios custom url schemes
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        isoSchemes: "wkzf://xxx",
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        android download page url
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        androidDownloadLink: "http://10.0.90.36/wechat/wukong/page/smartCityM.php",
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        ios download page url
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        iosDownloadLink: "http://10.0.90.36/wechat/wukong/page/smartCityM.php"
    }

})(jQuery)