+function(t){"use strict";function e(e){this.$table=t(e),this.$table.wrap('<div class="table-box"></div>'),this.$table.empty(),this.$thead=t("<thead></thead>"),this.$tbody=t("<tbody></tbody>"),this.$navigation=t('<div class="table-navigation"></div>'),this.$empty=t('<div class="no-data text-danger"><i class="iconfont icon-chucuo"></i><span>抱歉，找不到您想要的数据！</span></div>').hide(),this.$loading=t('<div class="loading"></loading>').hide(),this.$table.append(this.$thead).append(this.$tbody),this.$table.after(this.$navigation),this.$table.after(this.$empty),this.$table.append(this.$loading),this.$table.addClass("wktable")}function a(t){return function(e){return e[t.field]}}function i(t){var e=[];return t.forEach(function(t){if(t.subColumns&&t.subColumns.length>0)i(t.subColumns).forEach(function(t){e.push(t)});else{var s={text:t.text,value:"function"==typeof t.field?t.field:a(t),field:t.field};o(t).forEach(function(e){s[e]=t[e]}),e.push(s)}}),e}function o(t){return Object.getOwnPropertyNames(t).filter(function(t){return"text"!=t&&"field"!=t&&"subColumns"!=t&&"value"!=t&&"sortable"!=t&&"sortField"!=t&&"ascSort"!=t&&"descSort"!=t})}function s(){this.$navigation.hide(),this.$empty.show(),this.$tbody.hide()}function n(){this.$table.show(),this.$navigation.show(),this.$empty.hide(),this.$tbody.show()}function p(t){var e="";return o(t).forEach(function(a){e+=" "+a+"='"+t[a]+"'"}),e}function l(t){if("string"==typeof t.field)return t.field;if(t.sortField)return t.sortField;throw"列["+t.text+"]需要配置排序字段(sortField)"}function r(){this.$thead.empty(),this.columns=i(this.options.columns);var t=this.options.columns.map(function(t){var e="",a="";return t.subColumns&&t.subColumns.length>0?(e="<th colspan='"+t.subColumns.length+"'>"+t.text+"</th>",t.subColumns.forEach(function(t){a+=t.sortable?"<th class='sort' data-field='"+l(t)+"' "+p(t)+">"+t.text+"</th>":"<th "+p(t)+">"+t.text+"</th>"})):e=t.sortable?"<th rowspan='$rows$' class='sort' data-field='"+l(t)+"' "+p(t)+">"+t.text+"</th>":"<th rowspan='$rows$' "+p(t)+">"+t.text+"</th>",{level1:e,level2:a}}),e=1;t.forEach(function(t){""!==t.level2&&(e=2)});for(var a=0;a<t.length;a++)t[a].level1=t[a].level1.replace("$rows$",e);var o="",s="";t.forEach(function(t){o+=t.level1,s+=t.level2}),o="<tr>"+o+"</tr>",""!==s&&(s="<tr>"+s+"</tr>"),this.$thead.append(o),""!=s&&this.$thead.append(s),I.call(this)}function h(t){var e=this;this.$tbody.empty();var a="";t=t||[],t.forEach(function(t,i){a+=void 0!=t[e.options.uniqueId]?"<tr data-id='"+t[e.options.uniqueId]+"'>":"<tr>",e.columns.forEach(function(e){var s=o(e),n="";s.forEach(function(t){n+="  "+t+"='"+e[t]+"'"}),a+="<td "+n+" >"+e.value(t,i)+"</td>"}),a+="</tr>"}),this.$tbody.append(a)}function g(){return'<a href="#" class="less">...</a>'}function f(){return"<a href='#' class='more'>...</a>"}function c(t,e){return e?'<a href="#" class="page-index active">'+t+"</a>":'<a href="#" class="page-index">'+t+"</a>"}function d(){return'<a href="#" class="prev">&lt;&lt;</a>'}function u(){return'<a href="#" class="next">&gt;&gt;</a>'}function v(){var e=this;t(".page-index",this.$navigation).click(function(a){var i=t(this).text();a.preventDefault(),i!=e.pageInfo.pageIndex&&e.goto(i)}),t(".next",this.$navigation).click(function(t){var a=e.pageInfo.pageIndex;e.goto(a+1),t.preventDefault()}),t(".prev",this.$navigation).click(function(t){var a=e.pageInfo.pageIndex;e.goto(a-1),t.preventDefault()}),t(".page-size-select",this.$navigation).change(function(){e.pageInfo.pageSize=t(this).val(),e.goto(1)}),t(".go",this.$navigation).click(function(){var a=t(this).prev().val();e.goto(a)}),t(".refresh",this.$navigation).click(function(){e.refresh()}),t(".less",this.$navigation).click(function(t){var a=Math.floor(e.options.tableNavigation.paginationPageCount/2);e.goto(e.pageInfo.pageIndex-a),t.preventDefault()}),t(".more",this.$navigation).click(function(t){var a=Math.floor(e.options.tableNavigation.paginationPageCount/2);e.goto(e.pageInfo.pageIndex+a),t.preventDefault()}),t(".page-jump input",this.$navigation).on("keypress",function(a){"13"==a.keyCode&&e.goto(t(this).val())}).on("keyup",function(){var t=this.value.replace(/\D/gi,"");t&&(1>t&&(t=1),t>e.pageInfo.pageTotal&&(t=e.pageInfo.pageTotal)),this.value=t})}function I(){var e=this;t("."+e.options.sortClasses.sortClass,this.$thead).off("click").click(function(){var a=t(this),i=a.data("field");e.sort=i,a.hasClass(e.options.sortClasses.sortAscClass)?(e.sortType="desc",t("."+e.options.sortClasses.sortClass,e.$thead).removeClass(e.options.sortClasses.sortDescClass).removeClass(e.options.sortClasses.sortAscClass),a.addClass(e.options.sortClasses.sortDescClass)):(e.sortType="asc",t("."+e.options.sortClasses.sortClass,e.$thead).removeClass(e.options.sortClasses.sortDescClass).removeClass(e.options.sortClasses.sortAscClass),a.addClass(e.options.sortClasses.sortAscClass)),e.refresh()})}function b(){var t=this.$loading.width(),e=this.$loading.height(),a=this.$table.width(),i=this.$table.height(),o=(a-t)/2,s=(i-e)/2;this.$loading.css({left:o,top:s}).show()}function y(){this.$loading.hide()}function m(){if(this.$navigation.empty(),this.options.tableNavigation.displayTableNavigation){var e=this,a=t('<div class="pagination"></div>'),i=t('<select class="page-size-select"></select>'),o=t('<div class="page-jump"></div>');if(this.$navigation.append(a).append(t('<div class="page-size-div"></div>').append(i)).append(o),i.before("每页显示 ").after(" 条").wrap(t("<div></div>")),this.options.tableNavigation.displayPagination){var s=Math.floor(this.options.tableNavigation.paginationPageCount/2),n=this.pageInfo.pageIndex-s;n=1>n?1:n;var p=this.pageInfo.pageIndex+s;p=p>this.pageInfo.pageTotal?this.pageInfo.pageTotal:p;for(var l="",r=g(),h=f(),I=n;p>=I;I++)l+=c(I,this.pageInfo.pageIndex==I);n>2&&(l=r+l),n>1&&(l='<a href="#" class="page-index">1</a>'+l),p<this.pageInfo.pageTotal-1&&(l+=h),p<this.pageInfo.pageTotal&&(l+='<a href="#" class="page-index">'+this.pageInfo.pageTotal+"</a>");var b=d(),y=u();this.pageInfo.pageIndex>1&&(l=b+l),this.pageInfo.pageIndex<this.pageInfo.pageTotal&&(l+=y),a.append(l)}this.options.tableNavigation.displayPageSizeSelection?(l="",this.options.tableNavigation.pageSizeSet.forEach(function(t){l+=t==e.pageInfo.pageSize?"<option value='"+t+"' selected>"+t+"</option>":"<option value='"+t+"'>"+t+"</option>"}),i.append(l)):this.$navigation.find(".page-size-div").hide(),this.options.tableNavigation.displayPageJump&&o.append('<input type="text" value="'+this.pageInfo.pageIndex+'" /><button type="button" class="go">跳转</button>'),this.options.tableNavigation.displayPageJump&&o.append('<button type="button" class="refresh">刷新</button>'),this.$navigation.append("<div class='info'><span class=''>"+((this.pageInfo.pageIndex-1)*this.pageInfo.pageSize+1)+"-"+((this.pageInfo.pageIndex-1)*this.pageInfo.pageSize+this.pageInfo.size)+"</span>/共<span>"+this.pageInfo.total+"</span>条</div>"),v.call(this)}}function $(t){n.call(this),this.options.data?C.call(this,t):x.call(this,t)}function x(e){var a=this,i=e||this.pageInfo.pageIndex+1,o=this.pageInfo.pageSize,s={},n=this.options.pageInfoMapping.pageIndex,p=this.options.pageInfoMapping.pageSize,l=this.options.pageInfoMapping.sort,r=this.options.pageInfoMapping.sortType;a.options.tableNavigation.displayTableNavigation&&(s[n]=i,s[p]=o),s[l]=this.sort,s[r]=this.sortType;var h=t.extend({},this.options.params,s);for(var g in h)(null==h[g]||""==h[g])&&delete h[g];t.ajax({url:this.options.url,cache:this.options.cache||!1,data:"post"==this.options.method.toLowerCase()&&this.options.dataStringify?JSON.stringify(h):h,type:this.options.method,dataType:"json",contentType:this.options.contentType,beforeSend:function(){b.call(a)},success:function(t){if(y.call(a),t&&1502==t.status&&parent.window.location.reload(),t&&1==t.status){if("[object String]"===Object.prototype.toString.call(t.data)&&t.data){var e=JSON.parse(t.data);"1502"==e.messageNo&&parent.window.location.reload()}t=a.options.parse&&a.options.parse.call(a,t)||a.parse(t),S.call(a,t)}else{var i=t&&t.message||"查询数据失败";a.options.error&&a.options.error.call(a,i)}},error:function(){y.call(a),a.options.error&&a.options.error.call(a,"网络错误，请稍后重试")}})}function C(t){var e=t||this.pageInfo.pageIndex+1,a=this.pageInfo.pageSize,i=this.sort,o=this.sortType,s=this.options.params,n=this.options.data.filter(function(t){var e=Object.getOwnPropertyNames(s);return 0===e.length||e.filter(function(e){return null==s[e]||""==s[e]||t[e]==s[e]||t[e]&&t[e].toString().indexOf((s[e]||"").toString())>-1}).length===e.length}),p=n.length,l=Math.ceil(this.pageInfo.total/this.pageInfo.pageSize),r=function(t,e){return t[i].toString().localeCompare(e[i].toString())},h=function(t,e){return e[i].toString().localeCompare(t[i].toString())};if(""!==i&&void 0!=i){var g=this.options.columns.filter(function(t){return t.sortField==i||t.field==i})[0],f=g.ascSort||r,c=g.descSort||h;n=n.sort("desc"===o?c:f)}n=n.filter(function(t,i){return i>=(e-1)*a&&e*a>i}),S.call(this,{pageInfo:{total:p,pageTotal:l,pageIndex:e},items:n})}function S(t){this.pageInfo.pageIndex=t.pageInfo&&t.pageInfo.pageIndex||this.pageInfo.pageIndex+1,this.pageInfo.pageSize=t.pageInfo&&t.pageInfo.pageSize||this.pageInfo.pageSize,this.pageInfo.total=t.pageInfo&&t.pageInfo.total||1,this.pageInfo.pageTotal=Math.ceil(this.pageInfo.total/this.pageInfo.pageSize),this.pageInfo.size=t.items&&t.items.length||0,t.items&&t.items.length>0||s.call(this),h.call(this,t.items),m.call(this),this.options.ready&&this.options.ready.call(this,t.items),this.isReady=!0}function T(){var t,e,a,i,o,s,n=arguments[0]||{},p=1,l=arguments.length,r=!1;for("boolean"==typeof n&&(r=n,n=arguments[p]||{},p++),"object"==typeof n||jQuery.isFunction(n)||(n={}),p===l&&(n=this,p--);l>p;p++)if(null!=(t=arguments[p]))for(e in t)a=n[e],i=t[e],n!==i&&(r&&i&&(jQuery.isPlainObject(i)||(o=jQuery.isArray(i)))?(o?(o=!1,s=[]):s=a&&jQuery.isPlainObject(a)?a:{},n[e]=T(r,s,i)):void 0!==i&&(n[e]=i));return n}function w(e,a){return this.each(function(){var i=t(this),o=i.data("wk.table"),s=T(!0,{},z.DEFAULTS,i.data(),"object"==typeof e&&e);o||i.data("wk.table",o=new z(this,s)),"string"==typeof e&&o[e](a)})}var z=function(t,a){this.options=a,this.isReady=!1,this.pageInfo={pageIndex:this.options.pageIndex,pageSize:this.options.pageSize,pageTotal:0,total:100,size:0},this.sort=this.options.sort,this.sortType=this.options.sortType,e.call(this,t),this.$table.addClass(a.className),r.call(this),this.options.autoRequestAtTheFirstTime&&this.goto(1)};z.prototype.goto=function(t){t>this.pageInfo.pageTotal&&(t=this.pageInfo.pageTotal),1>t&&(t=1),this.pageInfo.pageIndex=t-1,$.call(this,t)},z.prototype.next=function(){var t=this.pageInfo.pageIndex+1;this.goto(t>this.pageInfo.pageTotal?this.pageInfo.pageTotal:t)},z.prototype.prev=function(){var t=this.pageInfo.pageIndex-1;this.goto(1>t?1:t)},z.prototype.refresh=function(){this.goto(this.pageInfo.pageIndex)},z.prototype.parse=function(t){return{pageInfo:{pageIndex:t.data.pageIndex,pageSize:t.data.pageSize,total:t.data.total},items:t.data.contents}},z.prototype.setOptions=function(t){return this.options=T(!0,{},this.options,t),this},z.prototype.search=function(t){this.setOptions({params:t}),this.goto(1)},z.prototype.destroy=function(){this.$empty.remove(),this.$navigation.remove(),this.$table.empty(),this.$table.removeClass("wktable"),this.$table.unwrap(),this.$table.data("wk.table",null)},z.DEFAULTS={className:"table table-hover",method:"get",contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:null,params:{},tableNavigation:{displayTableNavigation:!0,displayPagination:!0,displayPageJump:!0,displayPageSizeSelection:!0,displayRefresh:!0,pageSizeSet:[10,20,50,100,200,500],paginationPageCount:5},sortClasses:{sortClass:"sort",sortAscClass:"sort-asc",sortDescClass:"sort-desc"},pageSize:10,pageIndex:0,pageInfoMapping:{pageSize:"pageSize",pageIndex:"pageIndex",sort:"sort",sortType:"sortType"},uniqueId:"id",autoRequestAtTheFirstTime:!0,dataStringify:!0};var k=t.fn.wktable;t.fn.wktable=w,t.fn.wktable.Constructor=z,t.fn.wktable.noConflit=function(){return t.fn.wktable=k,this}}(jQuery);