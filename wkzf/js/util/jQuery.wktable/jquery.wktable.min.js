+function(t){"use strict";function a(a){this.$table=t(a),this.$table.empty(),this.$thead=t("<thead></thead>"),this.$tbody=t("<tbody></tbody>"),this.$navigation=t('<div class="table-navigation"></div>'),this.$empty=t('<div class="data-empty">请求数据为空:)</div>').hide(),this.$loading=t('<div class="loading"><img src="http://dev01.fe.wkzf/fe_public_library/wkzf/css/images/loading.gif" /></loading>').hide(),this.$table.append(this.$thead).append(this.$tbody),this.$table.after(this.$navigation),this.$table.after(this.$empty),this.$table.append(this.$loading),this.$table.addClass("wktable")}function e(t){return function(a){return a[t.field]}}function s(t){var a=[];return t.forEach(function(t){if(t.subColumns&&t.subColumns.length>0)s(t.subColumns).forEach(function(t){a.push(t)});else{var i={text:t.text,value:"function"==typeof t.field?t.field:e(t),field:t.field};o(t).forEach(function(a){i[a]=t[a]}),a.push(i)}}),a}function o(t){return Object.getOwnPropertyNames(t).filter(function(t){return"text"!=t&&"field"!=t&&"subColumns"!=t&&"value"!=t&&"sortable"!=t&&"sortField"!=t})}function i(){this.$table.hide(),this.$navigation.hide(),this.$empty.show()}function n(){this.$table.show(),this.$navigation.show(),this.$empty.hide()}function p(t){var a="";return o(t).forEach(function(e){a+=" "+e+"='"+t[e]+"'"}),a}function l(t){if("string"==typeof t.field)return t.field;if(t.sortField)return t.sortField;throw"列["+t.text+"]需要配置排序字段(sortField)"}function r(){this.$thead.empty(),this.columns=s(this.options.columns);var t=this.options.columns.map(function(t){var a="",e="";return t.subColumns&&t.subColumns.length>0?(a="<th colspan='"+t.subColumns.length+"'>"+t.text+"</th>",t.subColumns.forEach(function(t){e+=t.sortable?"<th class='sort' data-field='"+l(t)+"' "+p(t)+">"+t.text+"</th>":"<th "+p(t)+">"+t.text+"</th>"})):a=t.sortable?"<th rowspan='$rows$' class='sort' data-field='"+l(t)+"' "+p(t)+">"+t.text+"</th>":"<th rowspan='$rows$' "+p(t)+">"+t.text+"</th>",{level1:a,level2:e}}),a=1;t.forEach(function(t){""!==t.level2&&(a=2)});for(var e=0;e<t.length;e++)t[e].level1=t[e].level1.replace("$rows$",a);var o="",i="";t.forEach(function(t){o+=t.level1,i+=t.level2}),o="<tr>"+o+"</tr>",""!==i&&(i="<tr>"+i+"</tr>"),this.$thead.append(o),""!=i&&this.$thead.append(i),y.call(this)}function h(t){var a=this;this.$tbody.empty();var e="";t.forEach(function(t,s){e+=void 0!=t.id?"<tr data-id='"+t.id+"'>":"<tr>",a.columns.forEach(function(a){var i=o(a),n="";i.forEach(function(t){n+="  "+t+"='"+a[t]+"'"}),e+="<td "+n+" >"+a.value(t,s)+"</td>"}),e+="</tr>"}),this.$tbody.append(e)}function g(){return'<a href="#" class="less">...</a>'}function f(){return"<a href='#' class='more'>...</a>"}function c(t,a){return a?'<a href="#" class="page-index active">'+t+"</a>":'<a href="#" class="page-index">'+t+"</a>"}function d(){return'<a href="#" class="prev">&lt;&lt;</a>'}function u(){return'<a href="#" class="next">&gt;&gt;</a>'}function v(){t("."+this.options.sortClasses.sortClass,this.$thead).removeClass(this.options.sortClasses.sortAscClass).removeClass(this.options.sortClasses.sortDescClass)}function I(){var a=this;t(".page-index",this.$navigation).click(function(e){var s=t(this).text();e.preventDefault(),s!=a.pageInfo.pageIndex&&(v.call(a),a.goto(s))}),t(".next",this.$navigation).click(function(){var t=a.pageInfo.pageIndex;v.call(a),a.goto(t+1)}),t(".prev",this.$navigation).click(function(){var t=a.pageInfo.pageIndex;a.goto(t-1)}),t(".page-size-select",this.$navigation).change(function(){a.pageInfo.pageSize=t(this).val(),v.call(a),a.goto(1)}),t(".go",this.$navigation).click(function(){var e=t(this).prev().val();v.call(a),a.goto(e)}),t(".less",this.$navigation).click(function(){v.call(a);var t=Math.floor(a.options.tableNavigation.paginationPageCount/2);a.goto(a.pageInfo.pageIndex-t)}),t(".more",this.$navigation).click(function(){v.call(a);var t=Math.floor(a.options.tableNavigation.paginationPageCount/2);a.goto(a.pageInfo.pageIndex+t)}),t(".page-jump input",this.$navigation).on("keypress",function(e){"13"==e.keyCode&&a.goto(t(this).val())}).on("keyup",function(){var t=this.value.replace(/\D/gi,"");t&&(1>t&&(t=1),t>a.pageInfo.pageTotal&&(t=a.pageInfo.pageTotal)),this.value=t})}function y(){var a=this;t("."+a.options.sortClasses.sortClass,this.$thead).off("click").click(function(){var e=t(this),s=e.data("field");a.sort=s,e.hasClass(a.options.sortClasses.sortAscClass)?(a.sortType="desc",t("."+a.options.sortClasses.sortClass,a.$thead).removeClass(a.options.sortClasses.sortDescClass).removeClass(a.options.sortClasses.sortAscClass),e.addClass(a.options.sortClasses.sortDescClass)):(a.sortType="asc",t("."+a.options.sortClasses.sortClass,a.$thead).removeClass(a.options.sortClasses.sortDescClass).removeClass(a.options.sortClasses.sortAscClass),e.addClass(a.options.sortClasses.sortAscClass)),a.goto(1)})}function b(){var t=this.$loading.width(),a=this.$loading.height(),e=this.$table.width(),s=this.$table.height();if(!(a>s/2)){var o=(e-t)/2,i=(s-a)/2;this.$loading.css({left:o,top:i}).show()}}function C(){this.$loading.hide()}function $(){if(this.options.tableNavigation.displayTableNavigation){var a=this;this.$navigation.empty();var e=t('<div class="pagination"></div>'),s=t('<select class="page-size-select"></select>'),o=t('<div class="page-jump"></div>');if(this.$navigation.append(e).append(t('<div class="page-size-div"></div>').append(s)).append(o),s.before("每页显示 ").after(" 条").wrap(t("<div></div>")),this.options.tableNavigation.displayPagination){var i=Math.floor(this.options.tableNavigation.paginationPageCount/2),n=this.pageInfo.pageIndex-i;n=1>n?1:n;var p=this.pageInfo.pageIndex+i;p=p>this.pageInfo.pageTotal?this.pageInfo.pageTotal:p;for(var l="",r=g(),h=f(),v=n;p>=v;v++)l+=c(v,this.pageInfo.pageIndex==v);n>2&&(l=r+l),n>1&&(l='<a href="#" class="page-index">1</a>'+l),p<this.pageInfo.pageTotal-1&&(l+=h),p<this.pageInfo.pageTotal&&(l+='<a href="#" class="page-index">'+this.pageInfo.pageTotal+"</a>");var y=d(),b=u();this.pageInfo.pageIndex>1&&(l=y+l),this.pageInfo.pageIndex<this.pageInfo.pageTotal&&(l+=b),e.append(l)}this.options.tableNavigation.displayPageSizeSelection&&(l="",this.options.tableNavigation.pageSizeSet.forEach(function(t){l+=t==a.pageInfo.pageSize?"<option value='"+t+"' selected>"+t+"</option>":"<option value='"+t+"'>"+t+"</option>"}),s.append(l)),this.options.tableNavigation.displayPageJump&&o.append('<input type="text" value="'+this.pageInfo.pageIndex+'" /><button class="go">跳转</button>'),this.$navigation.append("<div class='info'><span class=''>"+((this.pageInfo.pageIndex-1)*this.pageInfo.pageSize+1)+"-"+this.pageInfo.pageIndex*this.pageInfo.pageSize+"</span>/共<span>"+this.pageInfo.total+"</span>条</div>"),I.call(this)}}function m(t){n.call(this),this.options.data?S.call(this,t):x.call(this,t)}function x(a){var e=this,s=a||this.pageInfo.pageIndex+1,o=this.pageInfo.pageSize,i={},n=this.options.pageInfoMapping.pageIndex,p=this.options.pageInfoMapping.pageSize,l=this.options.pageInfoMapping.sort,r=this.options.pageInfoMapping.sortType;i[n]=s,i[p]=o,i[l]=this.sort,i[r]=this.sortType;var h=t.extend({},this.options.params,i);t.ajax({url:this.options.url,data:h,type:this.options.method,dataType:"json",contentType:this.options.contentType,beforeSend:function(){b.call(e)},success:function(t){if(C.call(e),t&&1==t.status)t=e.options.parse&&e.options.parse.call(e,t)||e.parse(t),T.call(e,t);else{var a=t&&t.message||"查询数据失败";e.options.error&&e.options.error.call(e,a)}},error:function(){C.call(e),e.options.error&&e.options.error.call(e,"网络错误，请稍后重试")}})}function S(t){var a=t||this.pageInfo.pageIndex+1,e=this.pageInfo.pageSize,s=this.sort,o=this.sortType,i=this.options.params,n=this.options.data.filter(function(t){var a=Object.getOwnPropertyNames(i);return 0===a.length||a.filter(function(a){return t[a]==i[a]}).length===a.length}),p=n.length,l=Math.ceil(this.pageInfo.total/this.pageInfo.pageSize);""!==s&&(n=n.sort(function(t,a){return"desc"===o?a[s].toString().localCompare(t[s].toString()):t[s].toString().localCompare(a[s].toString())})),n=n.filter(function(t,s){return s>=(a-1)*e&&a*e>s}),T.call(this,{pageInfo:{total:p,pageTotal:l,pageIndex:a},items:n})}function T(t){this.pageInfo.pageIndex=t.pageInfo.pageIndex||this.pageInfo.pageIndex+1,this.pageInfo.pageSize=t.pageInfo.pageSize||this.pageInfo.pageSize,this.pageInfo.total=t.pageInfo.total,this.pageInfo.pageTotal=Math.ceil(this.pageInfo.total/this.pageInfo.pageSize),this.pageInfo.size=t.items.length,t.items&&t.items.length>0||i.call(this),h.call(this,t.items),$.call(this),this.options.ready&&this.options.ready.call(this)}function w(a,e){return this.each(function(){var s=t(this),o=s.data("wk.table"),i=t.extend(!0,{},z.DEFAULTS,s.data(),"object"==typeof a&&a);o||s.data("wk.table",o=new z(this,i)),"string"==typeof a&&o[a](e)})}var z=function(t,e){this.options=e,this.pageInfo={pageIndex:0,pageSize:10,pageTotal:0,total:100,size:0},this.sort=this.options.sort,this.sortType=this.options.sortType,a.call(this,t),r.call(this),this.goto(1)};z.prototype.goto=function(t){1>t&&(t=1),t>this.pageInfo.pageTotal&&(t=this.pageInfo.pageTotal),m.call(this,t)},z.prototype.next=function(){var t=this.pageInfo.pageIndex+1;this.goto(t>this.pageInfo.pageTotal?this.pageInfo.pageTotal:t)},z.prototype.prev=function(){var t=this.pageInfo.pageIndex-1;this.goto(1>t?1:t)},z.prototype.refresh=function(){this.goto(this.pageInfo.pageIndex)},z.prototype.parse=function(t){return{pageInfo:{pageIndex:t.data.pageIndex,pageSize:t.data.pageSize,total:t.data.total},items:t.data.contents}},z.prototype.setOptions=function(a){return this.options=t.extend(!0,{},this.options,a),this},z.prototype.search=function(t){this.setOptions({params:t}),this.goto(1)},z.DEFAULTS={method:"get",contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:null,params:{},tableNavigation:{displayTableNavigation:!0,displayPagination:!0,displayPageJump:!0,displayPageSizeSelection:!0,pageSizeSet:[10,20,50,100,200,500],paginationPageCount:5},sortClasses:{sortClass:"sort",sortAscClass:"sort-asc",sortDescClass:"sort-desc"},pageSize:10,pageInfoMapping:{pageSize:"pageSize",pageIndex:"pageIndex",sort:"sort",sortType:"sortType"}};var k=t.fn.wktable;t.fn.wktable=w,t.fn.wktable.Constructor=z,t.fn.wktable.noConflit=function(){return t.fn.wktable=k,this}}(jQuery);