+function($){function FilterContainer(t,e){this.table=t,this.params=e,this.init()}function CheckboxFilter(t,e){this.container=t,this.filter=e,this.$el=t.$tr.find("th:eq("+e.index+")"),this.init(),this.bindEvent()}function TextFilter(t,e){this.container=t,this.filter=e,this.$el=t.$tr.find("th:eq("+e.index+")"),this.init(),this.bindEvent()}function SelectFilter(t,e){this.container=t,this.filter=e,this.$el=t.$tr.find("th:eq("+e.index+")"),this.init(),this.bindEvent()}FilterContainer.prototype.init=function(){var t=this.table;if(this.wktable=$(t).data("wk.table"),this.wktable&&!this.wktable.filterContainer){this.wktable.filterContainer=this;var e=this,i=this.wktable.$thead.find("tr"),l=$(2==i.length?i[1]:i[0]);this.$tr=l,this.filters=[];var e=this,n=this.wktable.options.ready;this.wktable.options.ready=n?function(){n.call(e.wktable,arguments),e.createFilters()}:function(){e.createFilters()},this.wktable.isReady&&e.createFilters()}},FilterContainer.prototype.doFilter=function(){var t=this.wktable,e=[];t.$tbody.find("tr").hide().each(function(){e.push(this)}),this.filters.forEach(function(t){e=t.doFilter(e)}),e.forEach(function(t){$(t).show()})},FilterContainer.prototype.createFilters=function(){var t=this,e=this.params;this.filters&&this.filters.length>0?this.filters.forEach(function(t){t.rebuild&&t.rebuild()}):e&&e.filters&&(this.filters=[],e.filters.forEach(function(e){void 0!=e.index&&t.filters.push(t.createFilter(e))}),$("body").click(function(){t.hideAllFilter()}))},FilterContainer.prototype.createFilter=function(filter){var mapping=$.extend({},defaults.mapping,this.params.mapping),f=mapping[filter.type||"default"];return eval("var result = new "+f+"(this,filter);"),result},FilterContainer.prototype.hideAllFilter=function(){$(".wktable-filter-checkbox").hide(),$(".wktable-filter-select").hide()},CheckboxFilter.prototype.init=function(){var t=this.$el;t.addClass("wktable-th"),t.find(".wktable-filter-checkbox").remove(),t.find(".wktable-filter-icon").remove(),t.data("filter",this);var e=this.container.wktable.$tbody.find("tr td:nth-child("+(this.filter.index+1)+")"),i={};e.each(function(){i[$(this).text()]=""});var l="<ul class='wktable-filter-checkbox'>";for(var n in i)l+="<li><label><input type='checkbox' checked='checked' value='"+n+"'>"+n+"</label></li>";l+="</ul>",t.append("<span class='wktable-filter-icon glyphicon glyphicon-filter'></span>"),t.append(l)},CheckboxFilter.prototype.bindEvent=function(){var t=this.$el,e=this;t.find(".wktable-filter-checkbox").click(function(t){t.stopPropagation()}),t.find(".wktable-filter-icon").click(function(i){i.stopPropagation(),e.container.hideAllFilter(),t.find(".wktable-filter-checkbox").css({left:i.x,top:i.y+5}).toggle()}),t.find(".wktable-filter-checkbox :checkbox").click(function(){e.container.doFilter()})},CheckboxFilter.prototype.doFilter=function(t){var e=this.$el,i=[],l=e.find(":checked").map(function(){return this.value}),n=this;return t&&t.length>0&&l&&l.length>0&&t.forEach(function(t){var e=$(t).find("td:eq("+n.filter.index+")").text();l.each(function(l,n){e==n&&i.push(t)})}),i},CheckboxFilter.prototype.rebuild=function(){this.init(),this.bindEvent()};var modalHtml="<div class='modal'><div class='modal-dialog modal-sm'><div class='modal-content'><div class='modal-header'><a class='close' data-dismiss='modal'>&times;</a><h4 class='modal-title'>条件筛选</h4></div><div class='modal-body'><input type='text' class='form-control'></div><div class='modal-footer'><button type='button' class='btn btn-primary btn-confirm'>确定</button><button type='button' class='btn btn-default' data-dismiss='modal'>取消</button></div></div></div></div>";TextFilter.prototype.init=function(){var t=this.$el;t.find(".wktable-filter-icon").remove(),t.append("<span class='wktable-filter-icon glyphicon glyphicon-filter'></span>"),this.$modal=$(modalHtml),this.$modal.find("input").attr("placeholder",this.filter.text||t.text())},TextFilter.prototype.bindEvent=function(){var t=this.$el,e=this;t.find(".wktable-filter-icon").click(function(t){t.stopPropagation(),e.container.hideAllFilter(),e.prompt()}),this.$modal.find(".btn-confirm").click(function(){e.text=e.$modal.find("input").val(),e.$modal.modal("hide"),e.container.doFilter()}),this.$modal.find("input").on("keyup",function(t){13==t.keyCode&&(e.text=e.$modal.find("input").val(),e.$modal.modal("hide"),e.container.doFilter())})},TextFilter.prototype.prompt=function(){this.$modal.modal("show")},TextFilter.prototype.doFilter=function(t){var e=(this.$el,[]),i=this;return t&&t.length>0&&t.forEach(function(t){var l=$(t).find("td:eq("+i.filter.index+")").text();i.text?l.indexOf(i.text)>-1&&e.push(t):e.push(t)}),e},TextFilter.prototype.rebuild=function(){this.text=""},SelectFilter.prototype.init=function(){var t=this.filter.selects,e=this.$el;e.addClass("wktable-th"),e.find(".wktable-filter-select").remove(),e.find(".wktable-filter-icon").remove(),e.data("filter",this);var i="<ul class='wktable-filter-select'>";for(var l in t)i+="<li><label><input type='checkbox' checked='checked' value='"+t[l].value+"'>"+t[l].text+"</label></li>";i+="</ul>",e.append("<span class='wktable-filter-icon glyphicon glyphicon-filter'></span>"),e.append(i)},SelectFilter.prototype.bindEvent=function(){var t=this.$el,e=this;t.find(".wktable-filter-select").click(function(t){t.stopPropagation()}),t.find(".wktable-filter-icon").click(function(i){i.stopPropagation(),e.container.hideAllFilter(),t.find(".wktable-filter-select").css({left:i.x,top:i.y+5}).toggle()}),t.find(".wktable-filter-select :checkbox").click(function(){e.privateFilter()})},SelectFilter.prototype.doFilter=function(t){return t},SelectFilter.prototype.rebuild=function(){},SelectFilter.prototype.privateFilter=function(){var t=this.filter.paramName,e={},i=this.$el,l=i.find(":checked"),n=[];console.log(l),l.each(function(t,e){n.push(e.value)}),console.log(n),e[t]=n,$(this.container.table).wktable("search",{gender:n})},$.fn.setFilter=function(t){return this.each(function(){new FilterContainer(this,t)})};var defaults={filters:[],mapping:{text:"TextFilter",checkbox:"CheckboxFilter","default":"CheckboxFilter"}}}(jQuery);