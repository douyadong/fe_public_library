+function($){function FilterContainer(t,e){this.table=t,this.params=e,this.init()}function CheckboxFilter(t,e){this.container=t,this.filter=e,this.$el=t.$tr.find("th:eq("+e.index+")"),this.init(),this.bindEvent()}function TextFilter(t,e){this.container=t,this.filter=e,this.$el=t.$tr.find("th:eq("+e.index+")"),this.init(),this.bindEvent()}function SelectFilter(t,e){this.container=t,this.filter=e,this.$el=t.$tr.find("th:eq("+e.index+")"),this.init(),this.bindEvent()}FilterContainer.prototype.init=function(){var t=this.table;if(this.wktable=$(t).data("wk.table"),this.wktable&&!this.wktable.filterContainer){this.wktable.filterContainer=this;var e=this,i=this.wktable.$thead.find("tr"),n=$(2==i.length?i[1]:i[0]);this.$tr=n,this.filters=[];var e=this,l=this.wktable.options.ready;this.wktable.options.ready=l?function(){l.call(e.wktable,arguments),e.createFilters()}:function(){e.createFilters()},this.wktable.isReady&&e.createFilters()}},FilterContainer.prototype.doFilter=function(){var t=this.wktable,e=[];t.$tbody.find("tr").hide().each(function(){e.push(this)}),this.filters.forEach(function(t){e=t.doFilter(e)}),e.forEach(function(t){$(t).show()})},FilterContainer.prototype.createFilters=function(){var t=this,e=this.params;this.filters&&this.filters.length>0?this.filters.forEach(function(t){t.rebuild&&t.rebuild()}):e&&e.filters&&(this.filters=[],e.filters.forEach(function(e){void 0!=e.index&&t.filters.push(t.createFilter(e))}),$("body").click(function(){t.hideAllFilter()}))},FilterContainer.prototype.createFilter=function(filter){var mapping=$.extend({},defaults.mapping,this.params.mapping),f=mapping[filter.type||"default"];return eval("var result = new "+f+"(this,filter);"),result},FilterContainer.prototype.hideAllFilter=function(){$(this.table).find(".wktable-filter-checkbox").hide(),$(this.table).find(".wktable-filter-select").hide()},CheckboxFilter.prototype.init=function(){var t=this.$el;t.addClass("wktable-th"),t.find(".wktable-filter-checkbox").remove(),t.find(".wktable-filter-icon").remove(),t.data("filter",this);var e=this.container.wktable.$tbody.find("tr td:nth-child("+(this.filter.index+1)+")"),i={};e.each(function(){i[$(this).text()]=""});var n="<ul class='wktable-filter-checkbox'>";for(var l in i)n+="<li><label><input type='checkbox' checked='checked' value='"+l+"'>"+l+"</label></li>";n+="</ul>",t.append("<span class='wktable-filter-icon glyphicon glyphicon-filter'></span>"),t.append(n)},CheckboxFilter.prototype.bindEvent=function(){var t=this.$el,e=this;t.find(".wktable-filter-checkbox").click(function(t){t.stopPropagation()}),t.find(".wktable-filter-icon").click(function(i){i.stopPropagation(),e.container.hideAllFilter(),t.find(".wktable-filter-checkbox").css({left:i.x,top:i.y+5}).toggle()}),t.find(".wktable-filter-checkbox :checkbox").click(function(){e.container.doFilter()})},CheckboxFilter.prototype.doFilter=function(t){var e=this.$el,i=[],n=e.find(":checked").map(function(){return this.value}),l=this;return t&&t.length>0&&n&&n.length>0&&t.forEach(function(t){var e=$(t).find("td:eq("+l.filter.index+")").text();n.each(function(n,l){e==l&&i.push(t)})}),i},CheckboxFilter.prototype.rebuild=function(){this.init(),this.bindEvent()},TextFilter.prototype.init=function(){var t=this.$el;t.find(".wktable-filter-icon").remove(),t.append("<span class='wktable-filter-icon glyphicon glyphicon-filter'></span>")},TextFilter.prototype.bindEvent=function(){var t=this.$el,e=this;t.find(".wktable-filter-icon").click(function(t){t.stopPropagation(),e.container.hideAllFilter();var i=prompt("关键字",e.text||"");e.text=i,e.container.doFilter()})},TextFilter.prototype.doFilter=function(t){var e=(this.$el,[]),i=this;return t&&t.length>0&&t.forEach(function(t){var n=$(t).find("td:eq("+i.filter.index+")").text();i.text?n.indexOf(i.text)>-1&&e.push(t):e.push(t)}),e},TextFilter.prototype.rebuild=function(){this.text=""},SelectFilter.prototype.init=function(){var t=this.filter.selects,e=this.$el;e.addClass("wktable-th"),e.find(".wktable-filter-select").remove(),e.find(".wktable-filter-icon").remove(),e.data("filter",this);var i="<ul class='wktable-filter-select'>";for(var n in t)i+="<li><label><input type='checkbox' checked='checked' value='"+t[n].value+"'>"+t[n].text+"</label></li>";i+="</ul>",e.append("<span class='wktable-filter-icon glyphicon glyphicon-filter'></span>"),e.append(i)},SelectFilter.prototype.bindEvent=function(){var t=this.$el,e=this;t.find(".wktable-filter-select").click(function(t){t.stopPropagation()}),t.find(".wktable-filter-icon").click(function(i){i.stopPropagation(),e.container.hideAllFilter(),t.find(".wktable-filter-select").css({left:i.x,top:i.y+5}).toggle()}),t.find(".wktable-filter-select :checkbox").click(function(){e.privateFilter()})},SelectFilter.prototype.doFilter=function(t){return t},SelectFilter.prototype.rebuild=function(){},SelectFilter.prototype.privateFilter=function(){var t=this.filter.paramName,e={},i=this.$el,n=i.find(":checked"),l=[];console.log(n),n.each(function(t,e){l.push(e.value)}),console.log(l),e[t]=l,$(this.container.table).wktable("search",{gender:l})},$.fn.setFilter=function(t){return this.each(function(){new FilterContainer(this,t)})};var defaults={filters:[],mapping:{text:"TextFilter",checkbox:"CheckboxFilter","default":"CheckboxFilter"}}}(jQuery);